# Flyway
## 스프링 부트 ddl-auto 옵션
- DDL
  - Data Definition Language
  - 데이터 정의 언어
  - 구문
    - CREATE : 새로운 TABLE, VIEW, INDEX, STORED PROCEDURE 생성
    - DROP : 이미 존재하는 TABLE, VIEW, INDEX, STORED PROCEDURE 제거
    - ALTER : 이미 존재하는 데이터베이스 개체에 대한 변경, RENAME의 역할
    - TRUNCATE : 테이블 완전 삭제
- DDL-AUTO
  - 옵션
    - none : 사용X
    - update : 변경된 스키마 존재할 경우 적용
    - validate : 변경된 스키마 존재하는지 확인
    - create : 시작할 때 마다 스키마 생성
    - create-drop : 시작할 때 drop-create 생성, 종료할 때 drop 실행
  
## 데이터베이스 마이그레이션 :: Flyway
- 관계형 데이터베이스 스키마에 대한 증분, 가역적 변경 및 버전 제어 의미
- 해당 데이터베이스의 스키마를 최신 또는 이전 버전으로 업데이트 하거나 되돌릴 필요가 있을 때 마다 데이터베이스에서 수행됨
- 필요한 이유
  - 하나의 프로젝트에서 DB 스키마가 변경된 이력을 확인 할 수 없을 때?
    - 여러 작업자 간 동일한 DB 환경 구성 어려움
    -  DB 스키마에 문제 발생했을 때 해결 어려움
    -  Entity 객체 변화에 DB 스키마가 바로 반영되어 실수로 인해 데이터 손실 발생 가능

## Flyway
- SpringBoot에서 데이터베이스 스키마 변경 이력을 관리하는 기능을 제공하는 라이브러리 데이터베이스 버전 컨트롤 시스템

### 스키마를 관리하기 위한 7가지 기능
#### 1. Migrate
   - 스키마를 최신 버전으로 마이그레이션(갱신)
   - Flyway는 스키마 기록 테이블 자동으로 생성
   - 마이그레이션은 Flyway 워크 플로우의 핵심 기능
   - 파일 시스템 또는 클래스 경로 스캔 후 데이터베이스에 적용된 마이그레이션과 비교 수행
   - 차이가 존재할 경우 데이터베이스 마이그레이션 수행
   - Migrate는 데이터베이스와 코드의 기대치 사이의 비호환성 피하기 위해 애플리케이션 시작 시 실행하는 것을 추천
#### 2. Clean
   - 구성된 스키마의 모든 개체 삭제
   - 개발 및 테스트 시 큰 도움
   - 구성된 스키마를 완전히 삭제하여 효과적으로 새롭게 시작 가능
   - 모든 개체(테이블, 뷰, 프로시저 등)가 삭제되어 **production 사용 X**
#### 3. Info
   - 모든 마이그레이션에 대한 세부 정보 및 상태 정보 출력
   -  마이그레이션의 현재 세부 정보 확인 가능
#### 4. Validate
   - 사용 가능한 마이그레이션에 대해 유효성 검사 실행
   - 로컬에 사용된 마이그레이션이 데이터베이스에 적용된 마이그레이션과 일치하는지 확인
   - 우발적인 변경을 감지하여 스키마를 재생성하는 등의 오류를 방지하는데 유용
#### 5. Undo
   - 가장 최근에 적용된 버전 마이그레이션 실행 취소(커뮤니티 버전 사용 불가)
#### 6. Baseline
   - 기존 데이터베이스의 기준 설정
   - 특정 버전에서 기준선을 지정하여 기존 데이터베이스에 Flywawy를 도입하기 위한 것
   - 기준 버전을 포함한 모든 마이그레이션을 무시하여 최신 마이그레이션 적용
#### 7. Repair
   - 스키마 기록 테이블 복구
   - 실패한 마이그레이션 항목 제거(DDL 트랜잭션 지원하지 않는 데이터베이스에만 해당)
   - 적용된 마이그레이션 체크섬, 설명 및 유형을 사용 가능한 마이그레이션 중 하나와 재정렬
   - 누락된 모든 마이그레이션을 삭제됨으로 표시

### Naming
- prefix : V, U, R
- version : num
- Separator : __ (two underscores)
- Description : Underscores