# MSA
## MSA Introduction
- 복잡한 어플리케이션을 **독립적으로 배포** 가능한
- 작은 서비스로 나누는 데 초점을 맞춘 소프트웨어 아키텍처 스타일
- 서비스의 **확장성(scalability)** 과 **유연성(flexibility)** 을 확보하기 위해 어플리케이션을 독립적인 소규모 서비스로 분리하는 소프트웨어 개발 접근 방식

### Background
- 2011 : SW 아키텍처 워크샵에서 공동의 관심사인 아키텍처 스타일을 설명하기 위해 처음 등장
- 2012 : Microservices를 이 아키텍처를 표현하는 가장 적절한 이름으로 결정
- 2014 : James Lewis와 Martin Fowler가 블로그에 기재, 관심을 받기 시작
- 마이크로 서비스의 정의 및 특징 정의 -> MSA 이론의 표준처럼 인식_

### 주요 특징
- 각 서비스는 자체 프로세스에서 실행되고 **경량 메커니즘**으로 통신
  - REST
  - 메시지 큐
  - GRPC
- **비즈니스** 기능을 중심으로 분리
- 비즈니스 역량 중심의 조직 구성
- **자동화 된 배포 환경(인프라)** 을 통해 독립적으로 배포
- 각각의 서비스는 서로 다른 언어로 작성되고 서로 다른 데이터 저장 기술을 사용할 수 있음
- 중앙 집중식 관리가 거의 이루어지지 않음(**탈중앙화**)
- Monolithic vs MSA 
- **기술 선택의 유연성 (Tech Flexibility)** - 데이터 관점
  - 고객/상품 서비스 = 메타정보(원장) 관리, 구조화 된 정보, 대용량 처리
    - NoSQL - MongoDB, Amazon DynamoDB
  - 결제/주문 서비스 - 데이터의 정합성(신뢰성), 트랜잭션 보장, 백업 및 복구
    - RDB - MySQL, PostgreSQL, Oracle, MsSQL
  - 전시/광고/검색 - 빠른 조회
    - Elastic Search, In-Memory Databases - Redis

### 비즈니스 역량 기반의 조직 구성
- 모놀리식 
  - UI / 서버 / DB
- MSA
  - 검색 / 주문 / 결제
- Conway Rule - 기술의 구조는 조직의 구조를 따름
- MSA가 요구하는 조직
  - 교차 기능 팀
  - 자율성과 책임
  - 커뮤니케이션 및 협업

### Main Keywords
- 서비스 기반의 모듈화
- 비즈니스 역량 기반의 조직 구성
- 단일 책임 원칙 (SRP)
- 프로젝트가 아닌 프로덕트
- 탈중앙화 거버넌스
- 탈중앙화 데이터 관리
- 인프라 자동화

### DB의 분리
- 기능(서비스)은 분리 되었으나 데이터(DB)가 분리되지 않았다면?
  - 결제 처리 중 DB 부하로 인해 DB 서버에 장애가 생긴다면?
  - 대량의 상품 정보 갱신을 위한 배치 작업이 실행된다면?
  - Distributed Monolithic Application
  
### History
- **2001 : 애자일 선언**
  - 켄트 벡, 마틴 파울러
  - 소프트웨어 업계까 장기적인 계획이나 단계적 프로세스(폭포수 개발) 대신 점진적이고 반복적이며, 실용적인 실천법(스프린트)을 선호하게 됨
- **2006 : AWS EC2**
  - 아마존에서 IaaS 서비스인 EC2 발표, 최초 클라우드 사업 시작
- **2010 : NETFLIX - AWS 인프라 전환**
  - 넷플릭스는 비즈니스 확장으로 인한 스트리밍 데이터베이스의 스토리지 손실로 대규모 장애를 겪게 됨
  - 이 계기로 넷플릭스는 한 덩어리의 모놀리식 시스템에서 마이크로 서비스 기반의 시스템으로 전환, 인프라 환경을 클라우드로 이전
- **2012 : NETFLIX OSS**
  - 마이크로 서비스로 전환하는 과정 7년
  - 이 때의 문제점과 시행착오의 해결법을 오픈소스(Netflix OSS)로 공개
- **2013 : Docker 컨테이너 등장**
- **2013 : Spring Boot**
  - 마이크로 서비스를 쉽게 개발할 수 있는 Java 기반 Framework 발표 - Java 대통합 시대
- **2014 : Kubernetes**
  - 컨테이너 작업을 자동화하는 오픈소스 플랫폼. 구글 개발. CNCF에 프로젝트 기부

## Why, When, How MSA?

### MSA 구성요소와 아키텍처 패턴
- 어플리케이션의 복잡성 증가
- 개발 및 배포 주기 단축 필요
- 시스템의 확장성 및 복원력 요구 증가
- 클라우드 네이티브 아키텍처로의 전환
- 조직 효율성 및 DevOps 문화 요구
- 기술 다양성 및 선택권 확보

### Why MSA?
- **'장애를 극복하기 위한 생존의 문제'**
- 모놀리식
    - 결제가 안되는데(결제 DB) 로그인, 상품 검색, 주문 조차 되지 않는 상태
    - 결제 서비스가 정상화 될 떄 까지 모든 서비스 정지, 주문 불가
    - 큰 장애 복구 비용(전체 서비스의 복구)
    - 주문 불가, 사용자 이탈 및 매출 감소
  - 마이크로 서비스 어플리케이션
    - 결제는 안되지만 로그인, 상품 검색, 주문 까지는 정상 작동
    - 결제 전까지의 프로세스는 정상 작동
    - 장애 격리로 복구 비용 최소화
    - 고객경험/매출 손실의 최소화
- 비대해진 공통 코드.. 잦은 장애.. 밤샘 배포.. 위협받는 생존
- **Trend, Inovation** :: 가장 주목 받는 백엔드 기술 트랜드
  - MSA에는 분산 시스템, 클라우드 네이티브, 메세징 등 새로운 기술이 동반됨
  - **대규모 트래픽, 데이터**에 대응할 수 있는 아키텍처
- **Skill** :: 소프트웨어 엔지니어로서의 역량 향상
  - 현대의 분산 시스템 아키텍처의 중심 패턴
- DevOps와 Site Reliability Engineering(SRE) 문화 확산
  - 빌드/배포 자동화, 모니터링, 장애 대응 등의 역량이 중요해짐

### When MSA?
- 현재 운영 중인 서비스가 증가하는 **트래픽**으로 인해 서비스에 지장을 줄 정도의 장애가 발생하고 있는가?
- 그로 인한 서비스 **가용성**이 현저히 악화되고 있는가?
- 서비스의 복잡성이 현재의 모놀리식 구조에서 감당하기 힘들 정도로 높아져서 **서비스 확장성의 한계** 와 **개발 생산성의 저하**가 나타나는가?
- 어플리케이션 배포 시 그로 인한 서비스 전체의 **다운타임**이 서비스에 영향을 줄 만큼 지속적으로 증가하고 있는가?
- 서비스의 개발 보다 **장애대응, 배포**의 업무 비중이 증가하는가?

### How MSA?
- 고려사항
  - 서비스 성격과 개발/운영 조직과 환경이 MSA에 적합한지에 대한 검증과 철저한 준비 필요
- 스트랭글러 패턴
  - 기존 시스템을 한 번에 대체하는 대신, 시스템의 일부를 점진적으로 대체하면서 새로운 시스템으로 전환하는 방식
- 고려사항
  - **프록시 서버**를 통해 기존의 엔드 포인트로 요청되던 백엔드 요청을 가로채 새로운 서비스(MS)로 보내주는 작업 필요
- 꼭 필요할 때, 제대로된 조직 구성으로, 점직적으로!
  - [배달의 민족 마이크로 서비스 여행기](https://www.youtube.com/watch?v=BnS6343GTkY)

## MSA 도구 및 기술

## MSA 주요 적용 사례

## MSA 장단점